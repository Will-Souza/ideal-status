<!doctype html>
<html lang="pt-br">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <title>Ideal Status</title>
  </head>
  <body>
    <div class="container pt-4">

        <div class="row">
          <div class="col-4">
              <input type="text" id="buscar" class="form-control mb-3" placeholder="Digite a url do site">
          </div>
        </div>
        <table class="table table-bordered">
            <thead class="thead-dark">
              <tr>
                <th scope="col">URL</th>
                <th scope="col">STATUS</th>
              </tr>
            </thead>
            <tbody id="sitesTable">
              
            </tbody>
          </table>
    </div>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
        $(document).ready(function(){
          $("#buscar").on("keyup", function() {
            var value = $(this).val().toLowerCase();
            $(".table tr").filter(function() {
              $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
            });
          });



          async function getSites(sites){
            const request = await fetch(sites);
            return await request.json();
        }

        function appendStatus(tableColor, url, status){
            sitesTable.append(
            `<tr class="table-${tableColor}">
                <td>${url}</td>
                <td class="">${status}</td>
            </tr>`
            );    
        }

        let tableColor = '';

        const sitesTable = $('#sitesTable');

        getSites('http://127.0.0.1:5001/sites').then(obj => {
            obj.map(site => {
                console.log(site);
                site = `http://${site.trim()}/`;
                status = fetch(site).then(obj =>{
                    tableColor = 'success';
                    appendStatus(tableColor, obj.url, obj.status)

                }).catch(err => {
                    tableColor = 'danger';
                    appendStatus(tableColor, site, 'Erro')
                });
            });
        });
        });

        
    </script>
  </body>
</html>